---
layout: post
title: "Melhorando o “try()” do Ruby, a maneira “Groovy” [parte 2]"
date: 2008-03-05T15:32:00-03:00
categories:
 - Ruby
---

<div class='post'>
Vou pedir perdão ao meu amigo Urubatan, que publicou um <a href="http://www.urubatan.info/2008/03/a-better-try-for-ruby-why-not-do-the-groovy-way/">artigo</a> de mesmo nome.<br /><br /><pre><code>class Omega<br />   def doIt<br />     puts "ola"<br />     self<br />   end<br />end<br /><br />class NullableClass<br />   def method_missing(*x)<br />      self<br />   end<br />end<br /><br />class Object<br />   def existe?<br />      self<br />   end<br />end<br /><br />class NilClass<br />   def existe? <br />      NullableClass.new <br />   end<br />end<br /><br />xyz = Omega.new <br />xyz . existe? . doIt . doIt<br /><br />abc = nil<br />abc . existe? . doIt . doIt</code></pre><br /><br />Estou em duvida sobre o nome do metodo, por enquando fica <span style="font-weight:bold;">existe?</span> mesmo.<br /><br />O que isso faz? Imagine que vc tem uma variavel ou atributo de classe que <span style="font-style:italic;">pode</span> ser nil. Se for nil ela vai lançar um um erro em tempo de execução quando vc for tentar chamar algum método que a NilClass não possua (o que geralmente acontece, é semelhante ao NullPointerException do java).<br /><br />Eu poderia resolver isso alterando o method_missing da NilClass, porém alguns scripts podem estar esperando erros desse tipo. Decidi então criar um método que, para qualquer objeto, retorna ele mesmo (self). Caso seja nil, ele vai retornar um NullableClass (outro nome infeliz, não tenho nenhuma ideia melhor) que simplesmente retorna ele para qq método requisitado.<br /><br />IMHO pode ser o suficiente quando queremos fazer um teste simples: o objeto é nil? então não faz nada.<br /><br />Se alguem achar isso util por favor me avise :)<br /><br />Ah sim, a execução do script acima resulta em:<br /><pre>ola<br />ola</pre></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Urubatan</div>
<div class='content'>
como eu disse quando tu postou este comentário no meu blog, este teu esquema não resolve o problema de aninhamento de objetos, por exemplo<BR/><BR/>@person.company.manager.name<BR/>se eu digitar<BR/>@person.existe?.company.manager.name <BR/>e company for nil vai explodir tudo<BR/>e um .existe?. depois de cada objeto vai ficar gigante e pior do que o try na minha opinião :D</div>
</div>
</div>
