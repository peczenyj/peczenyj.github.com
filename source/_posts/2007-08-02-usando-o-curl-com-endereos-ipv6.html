---
layout: post
title: "Usando o curl com Endereços IPv6"
date: 2007-08-02T13:28:00-03:00
categories:
 - Shell
---

<div class='post'>
Hoje em dia usar endereçamento <a href="http://pt.wikipedia.org/wiki/IPv6">IPv6</a> parece um pouco exótico, porém aos poucos ele começa a aparecer em algumas redes internas e logo será a unica saída quando todos os 32 bits do IPv4 estiverem em uso, previsto para 2012.<br /> <br />Diga adeus ao "206.45.32.234" - longa vida ao "2001:bce4:5641:3412:341:45ae:fe32:65". Perceba como agora utilizamos a representação hexadecimal e cada quarteto é separado por um ':' -- o que torna mais fácil a sua memorização (e viva o DNS). Um bom artigo introdutório pode ser lido <a href="http://www.guiadohardware.net/artigos/entendendo-ipv6/">aqui</a>.<br /><br />Pois bem, imagine agora que precisamos acessar uma pagina em um servidor (por enquanto interno) através de um endereço IPv6. A url ficaria assim, por exemplo:<br /><br /><pre><code>http://[2001:bce4:5641:3412:341:45ae:fe32:65]:8000/index.php</code></pre><br /><br />Como o caracter ':' é usado em uma url para separar o servidor da porta (é claro que isso é omitido na maioria dos casos, quando usamos a porta 80), e tiveram que proteger o ip entre [colchetes]. Um browser como o Firefox consegue entender esta url facilmente, entretanto não tive a mesma sorte ao usar os browsers modo texto mais comuns - lynx e o curl. <br /><br />Não subestime a importância destes browsers! Muitas vezes nos encontramos em um sistema com poucos recursos ou precisamos efetuar certas ações via algum script e eles caem como uma luva -- principalmente o curl, que simplesmente transfere informações de/para um servidor web, fazendo GET, POST, HEAD, upload de arquivos, etc. <br /><br />No man do curl descobri que o mesmo depende da libcurl ser capaz de resolver endereços ipv6 - inclusive posso forçar a usar apenas ipv6 com a opção -6.<br /><br />Entretanto o curl tem outra interpretação dos colchetes em uma url -- elas são um recurso de sequência para multiplos downloads (da mesma forma como o bash faz, porém é interno ao curl), como nesse exemplo:<br /><br /><pre><code>curl 'http://www.any.org/archive[1996-1999]/volume[1-4]part{a,b,c,index}.html'</code></pre><br /><br />Para desabilitar este "URL globbing parser" basta usar a opção -g, o que nos leva a solução completa:<br /><br /><pre><code>curl -6g 'http://[2001:bce4:5641:3412:341:45ae:fe32:65]:8000/index.php'</code></pre><br /><br />Caso não queria desabilitar o globbing, basta 'escapar' os colchetes usando a contra-barra antes. O curl é um programa extremamente versátil, um verdadeiro canivete suíço na linha de comando, vale a pena estuda-lo em algum tempinho livre.</div>
