<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Demo prebid.js with Weborama RTD Module</title>
    <script>
        if (window.localStorage) {
            localStorage.setItem('webo_wam2gam_entry', '{"targeting":{"webo_cs":["red"]}}');
            localStorage.setItem('_lite', '{"webo_lite":{"lite_hobbies":["sport"]}}');
        }
    </script>
</head>

<body>
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script async src="js/prebid.js"></script>

    <script>
        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        pbjs.que.push(function () {
            pbjs.setConfig({
                debug: true,
                realTimeData: {
                    auctionDelay: 1000,
                    dataProviders: [{
                        name: "weborama",
                        waitForIt: true,
                        params: {
                            weboUserDataConf: {
                                accountId: 12345,
                            }
                        }
                    }]
                }
            });
        });
    </script>

    <script>
        var div_1_sizes = [
            [300, 300]
        ];

        var PREBID_TIMEOUT = 3000;
        var FAILSAFE_TIMEOUT = 5000;

        var adUnits = [{
            code: '/1056029/webo-ctx-prebid',
            mediaTypes: {
                banner: {
                    sizes: div_1_sizes
                }
            },
            bids: [{
                bidder: 'smartadserver',
                params: {
                    siteId: 1234,
                    pageId: 1234,
                    formatId: 1234,
                }
            }]
        }];

        // ======== DO NOT EDIT BELOW THIS LINE =========== //
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
        googletag.cmd.push(function () {
            googletag.pubads().disableInitialLoad();
        });

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        pbjs.que.push(function () {
            pbjs.addAdUnits(adUnits);
            pbjs.requestBids({
                bidsBackHandler: initAdserver,
                timeout: PREBID_TIMEOUT
            });
        });

        function initAdserver() {
            if (pbjs.initAdserverSet) return;
            pbjs.initAdserverSet = true;
            googletag.cmd.push(function () {
                pbjs.que.push(function () {
                    console.log("will call pbjs.setTargetingForGPTAsync / googletag.pubads().refresh()");
                    pbjs.setTargetingForGPTAsync();
                    googletag.pubads().refresh();
                });
            });
        }


        // in case PBJS doesn't load
        setTimeout(function () {
            initAdserver();
        }, FAILSAFE_TIMEOUT);

        googletag.cmd.push(function () {
            googletag.defineSlot('/1056029/webo-ctx-prebid', div_1_sizes, 'div-gpt-ad-1629281425486-0').addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <p>demo: prebid.js version LATEST with weborama RTD submodule using user-centric (wam) configuration only</p>
    <!-- /1056029/webo-ctx-prebid -->
    <div id='div-gpt-ad-1629281425486-0' style='min-width: 300px; min-height: 300px;'>
        <script>
            googletag.cmd.push(function () {
                googletag.display('div-gpt-ad-1629281425486-0');
            });
        </script>
    </div>
    <p>expects user-centric ad only</p>
    <button onclick="googletag.cmd.push(function() { googletag.pubads().refresh(); });">Show/Refresh Ad</button><br/>
    <a href="index.html">return to index</a>
</body>

</html>
