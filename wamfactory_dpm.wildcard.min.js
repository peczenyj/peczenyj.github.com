function WAM2GAM(e){var t=function(e,t,n){return e!=null&&e.hasOwnProperty(t)?e[t]:n},n=function(e,t){var n=Array.prototype.slice.call(t);return n.unshift(e),n},r=t(e,"debug",!1),i=t(e,"localStorageProfileKey","webo_gam_targeting"),s=t(e,"gamTargetingCustomSegmentKey","webo_cs"),o=t(e,"gamTargetingAudiencesKey","audiences"),u=t(e,"ttl",9e5),a=t(e,"baseUrl","https://bsd.frontend.weborama.fr/bsd"),f=t(e,"token",""),l=t(e,"wamid",0),c=t(e,"idcrm",""),h=t(e,"instanceName","wam2gam"),p=t(e,"callbackName","storeTargeting"),d=function(){var e=localStorage.getItem(i);if(!e)return m("nothing in local storage"),!0;var t=JSON.parse(e);if(typeof t!="object")return m("localStorage has something but it is not an object, deleting"),localStorage.removeItem(i),!0;if(!t.expiry)return m("localStorage has no expiry"),!0;var n=new Date;return n.getTime()>t.expiry},v=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return m("local storage not available, skip"),!1}},m=function(){r&&console.log.apply(console,n("[weborama wam2gam]",arguments))};this.getTargeting=function(){if(!v())return;var e=localStorage.getItem(i);if(!e){m("unable to update GAM: find nothing on local storage");return}var t=JSON.parse(e);if(typeof t!="object"){m("unable to update GAM: bad item, not an object, should remove key",i),localStorage.removeItem(i);return}var n=t.targeting;if(typeof n!="object"){m("unable to update GAM: bad targeting, not an object, should remove key",i),localStorage.removeItem(i);return}return n},this.clearCache=function(){if(!v())return;m("clear targeting from localStorage"),localStorage.removeItem(i)},this.storeTargeting=function(e){if(!e)return;if(!v())return;var t,n="custom_segments",r="audiences";e[n]&&(t=t||{},t[s]=e[n]),e[r]&&(t=t||{},t[o]=e[r]);var a=new Date,f={targeting:t,expiry:a.getTime()+u};m("localStorage.setItem",i,"with targeting",f),localStorage.setItem(i,JSON.stringify(f))},this.updateLocalTargeting=function(e){if(!l||!c||!f)return;if(!v())return;if(!d()){m("localStorage cache still valid, skip");return}var t=a+"?token="+f+"&format=jsonp&callback="+h+"."+p+"&wamid="+l+"&idcrm="+c;return e(t)},this.updateGAM=function(){m("update google tag with local targeting"),window.googletag=window.googletag||{cmd:[]};var e=this;googletag.cmd.push(function(){var t=e.getTargeting();for(var n in t)m("googletag.pubads().setTargeting",n,t[n]),googletag.pubads().setTargeting(n,t[n])})}}(function(){if(typeof window.__tcfapi=="function")return;if(typeof window.__cmp=="function")return;var e=function(e){var t=window,n=null;while(!n){try{t.frames[e]&&(n=t)}catch(r){}if(t===window.top)break;t=t.parent}return n},t,n,r={};if(t=e("__tcfapiLocator"))n="__tcfapiReturn",window.__tcfapi=function(e,n,i,s){var o=Math.random()+"",u={__tcfapiCall:{command:e,parameter:s,version:n,callId:o}};r[o]=i,t.postMessage(u,"*")};else{if(!(t=e("__cmpLocator")))return;n="__cmpReturn",window.__cmp=function(e,n,i){var s=Math.random()+"",o={__cmpCall:{command:e,parameter:n,callId:s}};r[s]=i,t.postMessage(o,"*")}}var i=function(e){var t={};try{t=typeof e.data=="string"?JSON.parse(e.data):e.data}catch(i){}var s=t[n];s&&typeof r[s.callId]=="function"&&(r[s.callId](s.returnValue,s.success),delete r[s.callId])};window.addEventListener("message",i,!1)})(),window.wamf=function(){return{version:"20210216_01",account:function(e){typeof e=="string"&&/^\d+$/.test(e)===!0?this.account=e:this.account=""},querytyp:function(e){typeof e=="string"&&/^\d+$/.test(e)===!0?this.typ=e:this.typ=""},eventkey:function(e){typeof e=="string"?this.ekey=e:this.ekey=""},eventvalue:function(e){typeof e=="string"?this.evalue=e:this.evalue=""},pushWvar:function(z){"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function this_value(){return this.valueOf()}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o,u=gap,a=t[e];switch(a&&"object"==typeof a&&"function"==typeof a.toJSON&&(a=a.toJSON(e)),"function"==typeof rep&&(a=rep.call(t,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(a)){for(s=a.length,n=0;s>n;n+=1)o[n]=str(n,a)||"null";return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+u+"]":"["+o.join(",")+"]",gap=u,i}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;s>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,a),i&&o.push(quote(r)+(gap?": ":":")+i));else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&o.push(quote(r)+(gap?": ":":")+i));return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+u+"}":"{"+o.join(",")+"}",gap=u,i}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();if(z.constructor===Array){function unique(e){var t=[],n=e.length;for(var r=0;r<n;r++){for(var i=r+1;i<n;i++)e[r]===e[i]&&(i=++r);t.push(e[r])}return t}if(z[0].match(/(.*):(.*)/)===null){var Wvartmp=[],Wstrtmp="",Wn=0;for(Wn=0;Wn<z.length;Wn++)Wn%2===1?(Wstrtmp+=z[Wn],Wvartmp.push(Wstrtmp)):Wstrtmp=z[Wn]+":";z=Wvartmp}z=unique(z),z.sort();var Wkeys=[],Wkk=[],Wvv=[],Wkeysp="",Wvarstr="",Wvarval="",Wcountval=0,Wi=0,Wj=0;e:for(Wi=0;Wi<z.length;Wi++){Wkk=z[Wi].match(/(.*):/);while(Wkk[1].indexOf(":")>0)Wkktmp=Wkk[1].match(/(.*):/),Wkk[1]=Wkktmp[1];for(var Wj=0;Wj<Wkeys.length;Wj++)if(Wkeys[Wj]==Wkk[1])continue e;Wkeys.push(Wkk[1])}for(Wi=0;Wi<Wkeys.length;Wi++){Wi==0?Wvarstr='{"'+Wkeys[Wi]+'":':Wvarstr+='"'+Wkeys[Wi]+'":',Wkeysp="",Wvarval="",Wcountval=0;for(Wj=0;Wj<z.length;Wj++){Wkk=z[Wj].match(/(.*):/);while(Wkk[1].indexOf(":")>0)Wkktmp=Wkk[1].match(/(.*):/),Wkk[1]=Wkktmp[1];Wvv=z[Wj].match(/:(.*)/),Wkeysp=Wkk[1],Wkeysp==Wkk[1]&&Wkk[1]==Wkeys[Wi]&&(Wvarval==""?Wvarval='"'+Wvv[1]+'"':(Wvarval+=',"'+Wvv[1]+'"',Wcountval++))}Wcountval>0&&(Wvarval="["+Wvarval+"]"),Wi+1==Wkeys.length?Wvarstr+=Wvarval+"}":Wvarstr+=Wvarval+","}this.Wvar=JSON.parse(Wvarstr)}else this.Wvar=z},_create_element_of_given_type:function(e,t){if(e=="image"){var n=new Image;n.src=t,n.onload=function(){return}}else if(e=="script"){var r=document.createElement("script");r.type="text/javascript",r.src=t;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)}else{var n=document.createElement("iframe");n.setAttribute("id","Wifrm"),document.body.appendChild(n),n.setAttribute("src",t),n.setAttribute("style","height: 1px; width: 1px; border: 0px none; position: absolute; display: none; left: 0px; top: 0px; z-index: 0;")}},send_after_cmp_check:function(e,t){if(typeof window.__tcfapi=="function"){var n=this;window.__tcfapi("getTCData",2,function(r,s){var o=function(e,t){for(i in t)if(t.hasOwnProperty(i)&&!e.purpose.consents[t[i]])return!1;return!0};t+=t.indexOf("?")==-1?"?":"&";if(!s)t+="gdpr=1&gdpr_cmp_failure=1";else if(!r.gdprApplies)t+="gdpr=0";else{if(r.eventStatus!=="useractioncomplete"&&!o(r,[1,3,4])){window.__tcfapi("addEventListener",2,function(r,i){i&&r!=null&&r.eventStatus=="useractioncomplete"&&(window.__tcfapi("removeEventListener",2,function(){},r.listenerId),t+="gdpr=1&gdpr_consent="+(r.tcString||""),n._create_element_of_given_type(e,t))});return}t+="gdpr=1&gdpr_consent="+(r.tcString||"")}n._create_element_of_given_type(e,t)})}else if(typeof window.__cmp=="function"){var n=this;window.__cmp("getConsentData",null,function(r,i){t+=t.indexOf("?")==-1?"?":"&",i?r.gdprApplies?t+="gdpr=1&gdpr_consent="+(r.consentData||""):t+="gdpr=0":t+="gdpr=1&gdpr_cmp_failure=1",n._create_element_of_given_type(e,t)})}else this._create_element_of_given_type(e,t)},pageSend:function(){var e;typeof this.Wvar!="object"?e={}:e=this.Wvar;if(this.account!=""&&this.typ!=""){e.wamid=this.account,e.typ=this.typ,e.url=encodeURIComponent(document.URL),e.ref=encodeURIComponent(document.referrer),WvarPageStr=encodeURIComponent(JSON.stringify(e)),WvarPageStr.length>1900&&(e.ref="",WvarPageStr=encodeURIComponent(JSON.stringify(e)));var t="wf";if(2510==this.account)t="lbcwf";else if(7424==this.account||1869==this.account||4702==this.account||6949==this.account||8058==this.account||3793==this.account||6787==this.account)t="wf-ru";this.send_after_cmp_check("image","https://"+t+".frontend.weborama.fr/stream/?wamid="+this.account+"&Wvar="+WvarPageStr+"&d.r="+(new Date).getTime())}},eventSend:function(e,t,n,r){window.wamf.querytyp(e),window.wamf.eventkey(t),window.wamf.eventvalue(n),typeof this.Wvar!="object"?WvarEvent={}:WvarEvent=this.Wvar;if(this.account!=""&&this.typ!=""&&this.ekey!=""&&this.evalue!=""){WvarEvent.wamid=this.account,WvarEvent.typ=this.typ,WvarEvent[this.ekey]=this.evalue,WvarEvent.url=encodeURIComponent(document.URL),WvarEvent.ref=encodeURIComponent(document.referrer),WvarEventStr=encodeURIComponent(JSON.stringify(WvarEvent)),WvarEventStr.length>1900&&(WvarEvent.ref="",WvarEventStr=encodeURIComponent(JSON.stringify(WvarEvent)));var i="wf";if(2510==this.account)i="lbcwf";else if(7424==this.account||1869==this.account||4702==this.account||6949==this.account||8058==this.account||3793==this.account||6787==this.account)i="wf-ru";this.send_after_cmp_check("image","https://"+i+".frontend.weborama.fr/stream/?wamid="+this.account+"&Wvar="+WvarEventStr+"&d.r="+(new Date).getTime())}},sync:function(e){if(e!=0){var t="https://cstatic.weborama.fr/iframe/"+(e==2?"external":"external_ids_sync")+".html?"+"wamid="+this.account+"&d.r="+(new Date).getTime();this.send_after_cmp_check("iframe",t)}},wam2gamObj:null,wam2gamObjConf:{instanceName:"window.wamf"},wam2gamConf:function(e){for(var t in e)this.wam2gamObjConf[t]=e[t]},wam2gam:function(){return this.wam2gamObj==null&&(this.wam2gamObj=new WAM2GAM(this.wam2gamObjConf)),this.wam2gamObj},storeTargeting:function(e){return this.wam2gam().storeTargeting(e)},updateGAM:function(){this.wam2gam().updateGAM();var e=this;return this.wam2gam().updateLocalTargeting(function(t){e.send_after_cmp_check("script",t)})},data:[],push:function(e,t){this.data.push(e.toString()),this.data.push(t.toString())},send:function(){window.wamf.pushWvar(this.data),window.wamf.pageSend()}}}(),typeof window.wamf_callback=="undefined"&&(typeof wamid=="undefined"&&(wamid=""),typeof typ=="undefined"&&(typ="1"),typeof Wvar=="undefined"&&(Wvar=""),typeof Wsync=="undefined"&&(Wsync=1),window.wamf.account(wamid),window.wamf.querytyp(typ),typeof Wam2gamConf!="undefined"&&(window.wamf.wam2gamConf(Wam2gamConf),window.wamf.updateGAM()),window.wamf.pushWvar(Wvar),window.wamf.pageSend(),window.wamf.sync(Wsync)),typeof window.wamf_callback=="function"&&(window.wamf_callback(),window.wamf_callback=function(){window.wamf.querytyp("1"),window.wamf.sync(2)});
