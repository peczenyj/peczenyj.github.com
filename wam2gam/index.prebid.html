<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>demo wamfactory wildcard + prebid.js</title>
		<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script async src="js/prebid.js"></script>
		<script>

         // PREBID CONFIGURATION
    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];

    pbjs.que.push(function() {
        pbjs.setConfig({
            debug: true,
	    realTimeData: {
                auctionDelay: 5000,	
                dataProviders: [
                    {
                        name: "weborama",
                        waitForIt: true,
                        params: {
                          weboCtxConf: {
                            token: "263GgpvUT8WDTRhPqPTz",
                            targetURL: "http://www.laprovence.com/actu/en-direct/5922313/video-rugby-a-xiii-elite-1-le-so-avignon-sincline-face-a-saint-esteve-xiii-catalan.html",
                            defaultProfile: {
                                webo_ctx: ["moon","etc"]
                            }
                          },
                          wam2gamConf: {Â setGAMTargeting: true }
                        }
                    }
                ]
            }
        });
    });

 
var div_1_sizes = [
	[300, 300]
];
var div_1_id = 'banner-ad-1';

var gam_ad_slot = '/1056029/webo-ctx-prebid';

    var PREBID_TIMEOUT = 3000;
    var FAILSAFE_TIMEOUT = 5000;

    var adUnits = [
        {
            code: gam_ad_slot, 
            mediaTypes: {
                banner: {
                    sizes: div_1_sizes
                }
            },
            bids: [{
                bidder: 'appnexus',
                params: {
                        placementId: 1
                }
            },{
                bidder: 'smartadserver',
                params: {}
            }]
        }
        ];
// see:
// https://developers.google.com/publisher-tag/guides/key-value-targeting
// https://developers.google.com/publisher-tag/guides/control-ad-loading

window.googletag = window.googletag || {cmd: []};

googletag.cmd.push(function() {
        googletag.pubads().disableInitialLoad();
});

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];

    pbjs.que.push(function() {
        pbjs.addAdUnits(adUnits);
        pbjs.requestBids({
            bidsBackHandler: initAdserver,
            timeout: PREBID_TIMEOUT
        });
    });

    function initAdserver() {
        if (pbjs.initAdserverSet) return;
        pbjs.initAdserverSet = true;
        googletag.cmd.push(function() {
            pbjs.que.push(function() {
                console.log("will call pbjs.setTargetingForGPTAsync / googletag.pubads().refresh()");
                pbjs.setTargetingForGPTAsync();
                googletag.pubads().refresh();
            });
        });
    }


    // in case PBJS doesn't load
    setTimeout(function() {
        initAdserver();
    }, FAILSAFE_TIMEOUT);
      
googletag.cmd.push(function() {
    googletag.defineSlot(gam_ad_slot, div_1_sizes, div_1_id).addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.enableServices();
});
</script>    
	</head>
	<body>
    <script type='text/javascript'>
var wamid = '259'; /* Wam Account ID */
var typ = '1'; /* Event Type default 1 */
var Wam2gamConf = { // if set, enable the feature
  debug: true,               // default is false
  ttl: 1 * 60 * 1000,        // default value is 15 * 60 * 1000
  key: "webo_wam2gam_entry", // default local storage key
  baseUrl: "https://bsd.frontend.weborama.fr/bsd", // default base url
  token: "JyqFfnyJvcF4",     // needed!
  idcrm: 11111,              // needed!
  cookieless: true,          // infer id from idcrm and ignore AFFICHE_W cookie
  useXdevice: true           // use idcrm to find all wam profiles and merge
};

(function(){
var w = document.createElement("script");
w.type = "text/javascript";
w.src = document.location.protocol + "//cstatic.weborama.fr/js/wam/customers/wamfactory_dpm.wildcard.min.js?rnd="+new Date().getTime();
w.async = true;
var body = document.getElementsByTagName('script')[0];
body.parentNode.insertBefore(w,body);
})();
</script>
		<p>combine wamf + prebid.js (wam2gam + contextual)</p>
		<div id='banner-ad-1' style='min-width: 300px; min-height: 300px;'>
			<script> googletag.cmd.push(function() { googletag.display(div_1_id); });</script>
		</div>

		<button onclick="googletag.cmd.push(function() { googletag.pubads().refresh(); });">Show/Refresh Ad</button>
	</body>
</html>
