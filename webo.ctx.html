<html>
  <head>
    <title>test contextual url profile</title>
    <script lang="text/javascript">      
      function fetchProfileFromContextualAPI(token, targetURL, timeout, responseTypeJSON, customHeader, logger){
      	    var weboramaURLProfileAPI = 'https://ctx-preprod.weborama.com/api/profile?token=' + token + '&url=' + encodeURIComponent(targetURL),
      	      method = 'GET',
      	      xhr = new XMLHttpRequest();
      	      
	    xhr.open(method, weboramaURLProfileAPI, true);
	    if (timeout>0)Â {
	      xhr.timeout = timeout;
	    }
	    if (responseTypeJSON){
	      xhr.responseType = 'json';
	    }
	    if (contentTypeJSON){
	      xhr.setRequestHeader('Content-Type', 'application/json');
	    }
	    if (customHeader.length == 2){
	      xhr.setRequestHeader(customHeader[0], customHeader[1]);
	    }
	    xhr.onreadystatechange = function () {
		if (this.readyState == 4){
		  if (this.status == 200) {	
		    var weboramaURLProfileResponse;
		    if (this.responseType === "json") {
		    	weboramaURLProfileResponse = this.response;
		    } else { 
		    	weboramaURLProfileResponse = JSON.parse(this.responseText);
		    }
		    console.log("weborama URL Profile API Response",weboramaURLProfileResponse);
	            logger("weborama URL Profile API Response");
		    logger(JSON.stringify(weboramaURLProfileResponse));  
		  } else {
		    console.log("unexpected code status when access URL Profile API", this.status);
		    logger("unexpected code status: " + this.status);
		  }
		  console.timeEnd("request sent");	
		}
	    };
	    xhr.ontimeout = function(){
	    	console.log("error while access weborama URL Profile API: timeout");
		logger("error while access weborama URL Profile API: timeout");
	    };  

	    console.time("request sent");  	
	    xhr.send(null);
      }

    </script>
  </head>
  <body>
    <div>
      <p>example</p>
      <fieldset>
      	<label for="token">token</label>
      	<input type="text" id="token" value="test-secret"/>
      </fieldset>
      <fieldset>
      	<label for="targetURL">target url</label>
      	<input type="text" id="targetURL" value="https://www.ladepeche.fr/2021/04/13/transition-ecologique-les-francais-attendent-beaucoup-des-energies-renouvelables-9485204.php"/>
      </fieldset>
      <fieldset>
      	<label for="timeout">timeout</label>
      	<input type="text" id="timeout"/>
      </fieldset>
      <fieldset>
    	<input type="checkbox" id="responseTypeJSON"><label for="responseTypeJSON">XMLHttpRequest property responseType=json</label>
      </fieldset>
      <fieldset>
    	<input type="checkbox" id="contentTypeJSON"><label for="contentTypeJSON">request content-type=application/json</label>
      </fieldset>
      <fieldset>
      	<label for="customHeader">Custom Header</label>
      	<input type="text" id="customHeader"/>
      </fieldset>
      <input type="button" id="submit" value="submit"/>
     </div>
     
    <div id="logger" style="overflow-y: scroll;">
	
    <script lang="text/javascript"> 	    
      var button = document.getElementById("submit");
      button.addEventListener('click', function(){
        var token = document.getElementById('token').value,
          targetURL = document.getElementById('targetURL').value,
          timeout = parseInt(document.getElementById('timeout').value, 10) || 0,
          responseTypeJSON = document.getElementById('responseTypeJSON').checked,
	  customHeader = document.getElementById('customHeader').value.split('='),
	  logger = document.getElementById("logger"),
	  mylog = function(text){
            var element = document.createElement("div");
            var txt = document.createTextNode(text);

            element.appendChild(txt);
            logger.appendChild(element);
          };
        console.log("calling fetchProfileFromContextualAPI",token, targetURL, timeout, responseTypeJSON, customHeader, mylog); 
      	fetchProfileFromContextualAPI(token, targetURL, timeout, responseTypeJSON, customHeader, mylog);
      });
    </script>

  </body>
</html>	
