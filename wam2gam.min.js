function ProfileCacheManager(e){var t=function(e,t,n){return e!=null&&e.hasOwnProperty(t)?e[t]:n},n=function(e,t){var n=Array.prototype.slice.call(t);return n.unshift(e),n},r=t(e,"debug",!1),i=t(e,"localStorageProfileKey","webo_profile"),s=t(e,"ttl",9e5),o=t(e,"base_url","https://bsd.frontend.weborama.fr/bsd"),u=t(e,"token",""),a=t(e,"wamid",0),f=t(e,"instance_name","weborama"),l=function(){var e=localStorage.getItem(i);if(!e)return h("nothing in local storage"),!0;var t=JSON.parse(e);if(typeof t!="object")return h("localStorage has something but it is not an object, deleting"),localStorage.removeItem(i),!0;if(!t.expiry)return h("localStorage has no expiry"),!0;var n=new Date;return n.getTime()>t.expiry},c=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return!1}},h=function(){r&&console.log.apply(console,n("[weborama wam2gam]",arguments))};this.getProfileFromCache=function(){if(!c()){h("local storage not available, skip");return}var e=localStorage.getItem(i);if(!e){h("unable to update GAM: find nothing on local storage");return}var t=JSON.parse(e);if(typeof t!="object"){h("unable to update GAM: bad item, not an object, should remove key",i),localStorage.removeItem(i);return}var n=t.value;if(typeof n!="object"){h("unable to update GAM: bad profile, not an object, should remove key",i),localStorage.removeItem(i);return}return n},this.clearCache=function(){if(!c()){h("local storage not available, skip");return}h("clear profile from localStorage"),localStorage.removeItem(i)},this.storeProfileOnCache=function(e){if(!c()){h("local storage not available, skip");return}var t=new Date,n={value:e,expiry:t.getTime()+s};h("localStorage.setItem",i,"with value",n),localStorage.setItem(i,JSON.stringify(n))},this.fetchProfileFromWAM=function(e,t){if(!c()){h("local storage not available, skip");return}if(!l()){h("localStorage cache still valid, skip");return}var n=o+("?token="+u)+("&format=jsonp&callback="+f+".storeProfileOnCache");return e.idcrm&&(n+="&wamid="+a+("&idcrm="+e.idcrm)),t(n)}};
