function WAM2GAM(e){var t=function(e,t,n){return e!=null&&e.hasOwnProperty(t)?e[t]:n},n=function(e,t){var n=Array.prototype.slice.call(t);return n.unshift(e),n},r=t(e,"debug",!1),i=t(e,"localStorageProfileKey","webo_gam_targeting"),s=t(e,"gam_targeting_custom_segment_key","webo_cs"),o=t(e,"ttl",9e5),u=t(e,"base_url","https://bsd.frontend.weborama.fr/bsd"),a=t(e,"token",""),f=t(e,"wamid",0),l=t(e,"instance_name","weborama"),c=t(e,"callback_name","storeTargeting"),h=function(){var e=localStorage.getItem(i);if(!e)return d("nothing in local storage"),!0;var t=JSON.parse(e);if(typeof t!="object")return d("localStorage has something but it is not an object, deleting"),localStorage.removeItem(i),!0;if(!t.expiry)return d("localStorage has no expiry"),!0;var n=new Date;return n.getTime()>t.expiry},p=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return d("local storage not available, skip"),!1}},d=function(){r&&console.log.apply(console,n("[weborama wam2gam]",arguments))};this.getTargeting=function(){if(!p())return;var e=localStorage.getItem(i);if(!e){d("unable to update GAM: find nothing on local storage");return}var t=JSON.parse(e);if(typeof t!="object"){d("unable to update GAM: bad item, not an object, should remove key",i),localStorage.removeItem(i);return}var n=t.targeting;if(typeof n!="object"){d("unable to update GAM: bad targeting, not an object, should remove key",i),localStorage.removeItem(i);return}return n},this.clearCache=function(){if(!p())return;d("clear targeting from localStorage"),localStorage.removeItem(i)},this.storeTargeting=function(e){if(!p())return;var t,n="custom_segments";e&&e[n]&&(t=t||{},t[s]=e[n]);var r=new Date,u={targeting:t,expiry:r.getTime()+o};d("localStorage.setItem",i,"with targeting",u),localStorage.setItem(i,JSON.stringify(u))},this.updateLocalTargeting=function(e,t){if(!p())return;if(!h()){d("localStorage cache still valid, skip");return}var n=u+("?token="+a)+("&format=jsonp&callback="+l+"."+c);return e.idcrm&&(n+="&wamid="+f+("&idcrm="+e.idcrm)),t(n)},this.updateGAM=function(){d("update google tag with local targeting"),window.googletag=window.googletag||{cmd:[]};var e=this;googletag.cmd.push(function(){var t=e.getTargeting();for(var n in t)d("googletag.pubads().setTargeting",n,t[n]),googletag.pubads().setTargeting(n,t[n])})}};
