function WAM2GAM(e){var t=function(e,t,n){return e!=null&&e.hasOwnProperty(t)?e[t]:n},n=function(e,t){var n=Array.prototype.slice.call(t);return n.unshift(e),n},r=t(e,"debug",!1),i=t(e,"localStorageProfileKey","webo_gam_targeting"),s=t(e,"gamTargetingCustomSegmentKey","webo_cs"),o=t(e,"gamTargetingAudiencesKey","audiences"),u=t(e,"ttl",9e5),a=t(e,"baseUrl","https://bsd.frontend.weborama.fr/bsd"),f=t(e,"token",""),l=t(e,"wamid",0),c=t(e,"idcrm",""),h=t(e,"instanceName","wam2gam"),p=t(e,"callbackName","storeTargeting"),d=function(){var e=localStorage.getItem(i);if(!e)return m("nothing in local storage"),!0;var t=JSON.parse(e);if(typeof t!="object")return m("localStorage has something but it is not an object, deleting"),localStorage.removeItem(i),!0;if(!t.expiry)return m("localStorage has no expiry"),!0;var n=new Date;return n.getTime()>t.expiry},v=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return m("local storage not available, skip"),!1}},m=function(){r&&console.log.apply(console,n("[weborama wam2gam]",arguments))};this.getTargeting=function(){if(!v())return;var e=localStorage.getItem(i);if(!e){m("unable to update GAM: find nothing on local storage");return}var t=JSON.parse(e);if(typeof t!="object"){m("unable to update GAM: bad item, not an object, should remove key",i),localStorage.removeItem(i);return}var n=t.targeting;if(typeof n!="object"){m("unable to update GAM: bad targeting, not an object, should remove key",i),localStorage.removeItem(i);return}return n},this.clearCache=function(){if(!v())return;m("clear targeting from localStorage"),localStorage.removeItem(i)},this.storeTargeting=function(e){if(!e)return;if(!v())return;var t,n="custom_segments",r="audiences";e[n]&&(t=t||{},t[s]=e[n]),e[r]&&(t=t||{},t[o]=e[r]);var a=new Date,f={targeting:t,expiry:a.getTime()+u};m("localStorage.setItem",i,"with targeting",f),localStorage.setItem(i,JSON.stringify(f))},this.updateLocalTargeting=function(e){if(!l||!c||!f)return;if(!v())return;if(!d()){m("localStorage cache still valid, skip");return}var t=a+"?token="+f+"&format=jsonp&callback="+h+"."+p+"&wamid="+l+"&idcrm="+c;return e(t)},this.updateGAM=function(){m("update google tag with local targeting"),window.googletag=window.googletag||{cmd:[]};var e=this;googletag.cmd.push(function(){var t=e.getTargeting();for(var n in t)m("googletag.pubads().setTargeting",n,t[n]),googletag.pubads().setTargeting(n,t[n])})}};
