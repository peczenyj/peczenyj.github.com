function WAM2GAM(e){var t=function(e,t,n){return e!=null&&e.hasOwnProperty(t)?e[t]:n},n=function(e,t){var n=Array.prototype.slice.call(t);return n.unshift(e),n},r=t(e,"debug",!1),i=t(e,"localStorageProfileKey","webo_profile"),s=t(e,"gamCustomSegmentKey","webo_cs"),o=t(e,"ttl",9e5),u=t(e,"base_url","https://bsd.frontend.weborama.fr/bsd"),a=t(e,"token",""),f=t(e,"wamid",0),l=t(e,"instance_name","weborama"),c=function(){var e=localStorage.getItem(i);if(!e)return p("nothing in local storage"),!0;var t=JSON.parse(e);if(typeof t!="object")return p("localStorage has something but it is not an object, deleting"),localStorage.removeItem(i),!0;if(!t.expiry)return p("localStorage has no expiry"),!0;var n=new Date;return n.getTime()>t.expiry},h=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return!1}},p=function(){r&&console.log.apply(console,n("[weborama wam2gam]",arguments))};this.updateGAM=function(){if(!h()){p("local storage not available, skip");return}var e=localStorage.getItem(i);if(!e){p("unable to update GAM: find nothing on local storage");return}var t=JSON.parse(e);if(typeof t!="object"){p("unable to update GAM: bad item, not an object, should remove key",i),localStorage.removeItem(i);return}var n=t.value;if(typeof n!="object"){p("unable to update GAM: bad profile, not an object, should remove key",i),localStorage.removeItem(i);return}var r=n.custom_segments;if(!r){p("find no custom segments on profile, skip");return}p("prepare gam setTargeting",s,"with data",r),window.googletag=window.googletag||{cmd:[]},googletag.cmd.push(function(){googletag.pubads().setTargeting(s,r)})},this.storeProfile=function(e){if(!h()){p("local storage not available, skip");return}var t=new Date,n={value:e,expiry:t.getTime()+o};p("localStorage.setItem",i,"with value",n),localStorage.setItem(i,JSON.stringify(n))},this.tryGetUpdateProfileURL=function(e,t){if(!c()){p("localStorage cache still valid, skip");return}var n=u+("?token="+a)+("&format=jsonp&callback="+l+".storeProfile");return e.idcrm&&(n+="&wamid="+f+("&idcrm="+e.idcrm)),t(n)}};
