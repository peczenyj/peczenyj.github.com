<html>
  <head>
    <title>Example WAM2GAM #2</title>

    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script type="text/javascript">
      window.googletag = window.googletag || {cmd: []};

      googletag.cmd.push(function() {
        googletag.defineSlot('/1056029/test-for-code-333', [333, 333], 'div-gpt-ad-1611151950096-0').addService(googletag.pubads());
        googletag.enableServices();
      });

      // this substitute weborama.updateGAM()
      // to be used when we should be fast
      googletag.cmd.push(function() {
        var data = JSON.parse(localStorage.getItem("webo_gam_targeting")) ||Â {},
        targeting = data["targeting"];
        for(var key in targeting){
          googletag.pubads().setTargeting(key, targeting[key]);
        }
      });
    </script>
  </head>
  <body>
    <p>please make sure you have no AFFICHE_W cookie. using idcrm 22222 should present advertiser BLUE</p>
    <script src="wam2gam.min.js"></script>
    <script>
      var conf = {
        debug: true,             // default is false
        ttl: 15 * 60 * 1000,     // default value
        key: "weborama_profile", // local storage key
        base_url: "https://bsd.frontend.weborama.fr/bsd", // default base url
        token: "JyqFfnyJvcF4",   // needed!
        wamid: 259,              // needed!
        instance_name: "weborama"  // to be possible call via jsonp
      };

      var weborama = new WAM2GAM(conf);

      function callScript(url){
        // TODO add gdpr url decoration

        var g = document.createElement('script');
        g.type = 'text/javascript';
        g.src = url;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(g, s);

        console.log("calling script url",url);
      }
  </script>
    <div>
      <button onClick="weborama.clearCache()">Clear Profile Cache</button><br/>
    </div>
    <!-- /1056029/test-for-code-333 -->
    <div id='div-gpt-ad-1611151950096-0' style='width: 333px; height: 333px;'>
      <script>
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1611151950096-0'); });

        weborama.updateLocalTargeting({
          idcrm: '22222', // hard coded version, with BLUE custom segment
        }, callScript);
      </script>
    </div>
  </body>
</html>
