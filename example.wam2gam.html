<html>
  <head>
    <title>GAM demo local storage #4</title>

    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script type="text/javascript">
      window.googletag = window.googletag || {cmd: []};

      googletag.cmd.push(function() {
        googletag.defineSlot('/1056029/test-for-code-333', [333, 333], 'div-gpt-ad-1611151950096-0').addService(googletag.pubads());
        googletag.enableServices();
      });
    </script>
  </head>
  <body>
    <p>please make sure you have no AFFICHE_W cookie</p>
    <script src="wam2gam.min.js?rnd=8343243242"></<script>
    <script type="text/javascript">
console.log(1);
            var conf = {
              debug: true,             // default is false
              ttl: 15 * 60 * 1000,     // default value
              key: "weborama_profile", // local storage key
              base_url: "https://bsd.frontend.weborama.fr/bsd", // default base url
              token: "JyqFfnyJvcF4",   // needed!
              wamid: 259,              // needed!
              instance_name: "weborama"  // to be possible call via jsonp
            };
console.log(2);
            window.weborama = new WAM2GAM(conf);
console.log(3);
            function callScript(url){
              var g = document.createElement('script');
              g.type = 'text/javascript';
              g.src = url;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(g, s);

              console.log("calling script url",url);
            }
console.log(4);
            function callProfile(idcrm){
              weborama.tryGetUpdateProfileURL({
                idcrm: idcrm
              }, callScript);
            }
      
      console.log(5);
  </script>

    <div>
      <button onClick="weborama.clearProfile()">Clear Profile</button><br/>

      <button onClick="callProfile('11111')">change to crm id 11111 - weboid blrVU0TAaAVu - custom segment: red</button><br/>
      <button onClick="callProfile('22222')">change to crm id 22222 - weboid z6afcHuqmc3P - custom segment: blue</button><br/>
      <button onClick="callProfile('33333')">change to crm id 33333 - weboid rHQmeb8b5D@s - custom segment: red and blue</button><br/>
      <button onClick="callProfile('44444')">change to crm id 44444 - weboid Acy-dxu41N8B - custom segment: none</button><br/>

    </div>
    <!-- /1056029/test-for-code-333 -->
    <div id='div-gpt-ad-1611151950096-0' style='width: 333px; height: 333px;'>
      <script>
        weborama.updateGAM(); // read from local storage and call GAM

        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1611151950096-0'); });
      </script>
    </div>
  </body>
</html>
